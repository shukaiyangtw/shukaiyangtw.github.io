function ivec2(t,e){this.x=t,this.y=e}function irect(t,e,i,n){this.left=t,this.top=e,this.right=i,this.bottom=n}function newRectXYWH(t,e,i,n){return new irect(t,e,t+i,e+n)}function ListNode(t){this.obj=t,this.prev=null,this.next=null}function LinkedList(){this.head=null,this.tail=null}ivec2.prototype.len=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},ivec2.prototype.dist=function(t){var e=this.x-t.x,t=this.y-t.y;return Math.sqrt(e*e+t*t)},irect.prototype.width=function(){return this.right-this.left},irect.prototype.height=function(){return this.bottom-this.top},irect.prototype.setSize=function(t,e){this.right=this.left+t,this.bottom=this.top+e},irect.prototype.collide=function(t){return!(t.left>this.right)&&(!(t.right<this.left)&&(!(t.top<this.bottom)&&!(t.bottom>this.top)))},LinkedList.prototype.add=function(t){let e=new ListNode(t);null==this.tail?this.head=e:(this.tail.next=e,e.prev=this.tail),this.tail=e},LinkedList.prototype.deleteNode=function(t){null==t.prev?null==t.next?(this.head=null,this.tail=null):(this.head=t.next,this.head.prev=null):null==t.next?(this.tail=t.prev,this.tail.next=null):(t.prev.next=t.next,t.next.prev=t.prev),t.obj=null,t=null},LinkedList.prototype.clear=function(){let t=this.tail;for(;null!=t;){var e=t.prev;t.obj=null,t=null,t=e,null!=t&&(t.next=null)}this.head=null,this.tail=null},LinkedList.prototype.isEmpty=function(){return null==this.head};let viewWidth=1512,viewHeight=850,densityX=1,densityY=1,canvasWidth=1512,canvasHeight=850,msecsPerFrame=33;function setViewportSize(t,e){viewWidth=t,viewHeight=e}function autoCanvasSize(t){var e=t.clientWidth/t.clientHeight,i=viewWidth/viewHeight;let n=new ivec2(viewWidth,viewHeight);return i<e?(n.y=t.clientHeight,densityY=n.y/viewHeight,densityX=densityY,n.x=densityX*viewWidth):(n.x=t.clientWidth,densityX=n.x/viewWidth,densityY=densityX,n.y=densityY*viewHeight),canvasWidth=n.x,canvasHeight=n.y,n}function setCanvasSize(t,e){canvasWidth=t,canvasHeight=e,densityX=t/viewWidth,densityY=e/viewHeight}function getCanvasSize(t){return autoCanvasSize(t)}function setElementSizeScr(e,i){let n=document.getElementById(e);if("frame_buffer"===n.className){e=window.devicePixelRatio||1;n.width=i.x*e,n.height=i.y*e;let t=n.getContext("2d");t.setTransform(1,0,0,1,0,0),t.scale(e,e)}else n.width=i.x,n.height=i.y;n.style.width=i.x+"px",n.style.height=i.y+"px"}function TextureImage(t,e,i,n){null!=n?(this.img=new Image,this.img.onload=n,this.img.src=i):this.img=document.getElementById(i),this.rows=t,this.cols=e,this.swidth=0,this.sheight=0}TextureImage.prototype.fileName=function(){var t=this.img.src.split("/");return t[t.length-1]},TextureImage.prototype.drawScr=function(t,e,i,n,s,h,r){1==this.rows&&1==this.cols?t.drawImage(this.img,e,i,n,s):(0==this.swidth&&(this.swidth=this.img.width/this.cols),0==this.sheight&&(this.sheight=this.img.height/this.rows),r=this.swidth*r,h=this.sheight*h,t.drawImage(this.img,r,h,this.swidth,this.sheight,e,i,n,s))},TextureImage.prototype.draw=function(t,e,i,n,s,h,r){e*=densityX,i*=densityY,n*=densityX,s*=densityY;this.drawScr(t,e,i,n,s,h,r)},TextureImage.prototype.drawRect=function(t,e,i,n){var s=e.left*densityX,h=e.top*densityY,r=(e.right-e.left)*densityX,e=(e.bottom-e.top)*densityY;this.drawScr(t,s,h,r,e,i,n)};let frameBuffers=[],frameContexts=[],CurFrameIndex=0,requestRender=!0;function getBackBufferContext(){if(0==frameContexts.length)for(let t=0;t<frameBuffers.length;++t)frameContexts.push(frameBuffers[t].getContext("2d"));var t=1-CurFrameIndex;let e=frameContexts[t];return e.clearRect(0,0,canvasWidth,canvasHeight),e}function swapBuffers(){var t=1-CurFrameIndex;frameBuffers[CurFrameIndex].style.visibility="hidden",frameBuffers[t].style.visibility="visible",CurFrameIndex=t,requestRender=!1}