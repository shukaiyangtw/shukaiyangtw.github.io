var btnSize=80,btnPadding=30,kbName=["KeyA","KeyS","KeyZ","KeyX","ArrowUp","ArrowRight","ArrowLeft","ArrowDown"],kbEnabled=[!1,!1,!1,!1,!1,!1,!1,!1],kbState=[!1,!1,!1,!1,!1,!1,!1,!1],kbTriggered=[!1,!1,!1,!1,!1,!1,!1,!1],kbTriggerable=[!0,!0,!0,!0,!0,!0,!0,!0];const kbA=0,kbS=1,kbZ=2,kbX=3,kbUp=4,kbRight=5,kbLeft=6,kbDown=7;var keysTex,keysTexDown,touchTarget,kbPreventDefault=!0,kbResizeButtons=!1,keysRectScr=[],compRectScr=[],compIndices=[[kbUp,kbLeft],[kbUp,kbRight],[kbDown,kbLeft],[kbDown,kbRight]],curTouches=[],mouseDown=!1;function indexOfTouch(t){for(let e=0;e<curTouches.length;++e)if(curTouches[e].id===t)return e;return-1}function setButtonSize(e,t){btnSize=e,btnPadding=t}function setupKeyboard(e,t,r,c,n,o,b,i,k){touchTarget=e,kbEnabled[0]=t,kbEnabled[1]=r,kbEnabled[2]=c,kbEnabled[3]=n,kbEnabled[4]=o,kbEnabled[5]=b,kbEnabled[6]=i,kbEnabled[7]=k,resizeKeyboard(),window.addEventListener("keydown",onKeyDown),window.addEventListener("keyup",onKeyUp),e.addEventListener("touchstart",onTouch,!1),e.addEventListener("touchmove",onTouch,!1),e.addEventListener("touchend",onTouch,!1),e.addEventListener("touchcancel",onTouch,!1),e.addEventListener("mousedown",onMouse,!1),e.addEventListener("mousemove",onMouse,!1),e.addEventListener("mouseup",onTouchClear,!1)}function resizeKeyboard(){var e=viewWidth*densityX,t=viewHeight*densityY;let r=btnSize,c=btnSize,n=btnPadding,o=btnPadding;1==kbResizeButtons&&(r=btnSize*densityX,c=btnSize*densityY,n=btnPadding*densityX,o=btnPadding*densityY),keysRectScr.length=0,compRectScr.length=0;var b=t-2*c-o,i=b-c;let k=e-2*r-2*n;t=new irect(k,i,k+r,i+c);keysRectScr.push(t),kbEnabled[0]?k+=r+n:k+=(r+n)/2,t=new irect(k,i,k+r,i+c),keysRectScr.push(t),k=e-2*r-2*n,i=b+o,t=new irect(k,i,k+r,i+c),keysRectScr.push(t),k+=r+n,t=new irect(k,i,k+r,i+c),keysRectScr.push(t),i=b-c,k=r+n,t=new irect(k,i,k+r,i+c),keysRectScr.push(t),k+=r,i=b,t=new irect(k,i,k+r,i+c),keysRectScr.push(t),k=n,t=new irect(k,i,k+r,i+c),keysRectScr.push(t),k=r+n,i=b+c,t=new irect(k,i,k+r,i+c),keysRectScr.push(t),k=keysRectScr[kbLeft].left,i=keysRectScr[kbUp].top,t=new irect(k,i,k+r,i+c),compRectScr.push(t),k=keysRectScr[kbRight].left,t=new irect(k,i,k+r,i+c),compRectScr.push(t),k=keysRectScr[kbLeft].left,i=keysRectScr[kbDown].top,t=new irect(k,i,k+r,i+c),compRectScr.push(t),k=keysRectScr[kbRight].left,t=new irect(k,i,k+r,i+c),compRectScr.push(t),requestRender=!0}function drawKeyboard(t){let r=btnSize,c=btnSize;1==kbResizeButtons&&(r=btnSize*densityX,c=btnSize*densityY);for(let e=0;e<kbState.length;++e)1==kbEnabled[e]&&(1==kbState[e]?keysTexDown:keysTex).drawScr(t,keysRectScr[e].left,keysRectScr[e].top,r,c,0,e)}onKeyDown=function(t){for(let e=0;e<kbName.length;++e)if(t.code==kbName[e])return 1==kbEnabled[e]&&(kbState[e]=!0,1==kbTriggerable[e]&&(kbTriggered[e]=!0,kbTriggerable[e]=!1)),void(requestRender=!0)},onKeyUp=function(t){for(let e=0;e<kbName.length;++e)if(t.code==kbName[e])return kbState[e]=!1,kbTriggered[e]=!1,kbTriggerable[e]=!0,void(requestRender=!0)},onTouch=function(e){let r=[!1,!1,!1,!1,!1,!1,!1,!1];var t=e.changedTouches;if(1==kbPreventDefault&&e.preventDefault(),"touchstart"==e.type)for(let e=0;e<t.length;++e){var c=t[e];curTouches.push({id:c.identifier,pageX:c.pageX,pageY:c.pageY})}else if("touchmove"==e.type)for(let e=0;e<t.length;++e){var n=t[e],o=indexOfTouch(n.identifier);if(0<=o){let e=curTouches[o];e.pageX=n.pageX,e.pageY=n.pageY,curTouches.splice(o,1,e)}}else if("touchend"==e.type||"touchcancel"==e.type)for(let e=0;e<t.length;++e){var b=indexOfTouch(t[e].identifier);0<=b&&curTouches.splice(b,1)}for(let t=0;t<kbState.length;++t)if(1==kbEnabled[t])for(let e=0;e<curTouches.length;++e){var i=curTouches[e],k=i.pageX-touchTarget.offsetLeft,i=i.pageY-touchTarget.offsetTop;if(k>keysRectScr[t].left&&k<keysRectScr[t].right&&i>keysRectScr[t].top&&i<keysRectScr[t].bottom){r[t]=!0;break}}for(let t=0;t<compRectScr.length;++t)for(let e=0;e<curTouches.length;++e){var s=curTouches[e],a=s.pageX-touchTarget.offsetLeft,s=s.pageY-touchTarget.offsetTop;if(a>compRectScr[t].left&&a<compRectScr[t].right&&s>compRectScr[t].top&&s<compRectScr[t].bottom){let e=compIndices[t][0];1==kbEnabled[e]&&(r[e]=!0),e=compIndices[t][1],1==kbEnabled[e]&&(r[e]=!0);break}}for(let e=0;e<kbState.length;++e)1==kbEnabled[e]&&r[e]!=kbState[e]&&(1==kbState[e]?(kbState[e]=!1,kbTriggered[e]=!1,kbTriggerable[e]=!0):(kbState[e]=!0,1==kbTriggerable[e]&&(kbTriggered[e]=!0,kbTriggerable[e]=!1)));requestRender=!0},onMouse=function(e){let t=!1,r=[!1,!1,!1,!1,!1,!1,!1,!1];if(e.preventDefault(),"mousedown"==e.type)mouseDown=!0;else if("mousemove"==e.type&&0==mouseDown)return;var c=e.clientX-touchTarget.offsetLeft,n=e.clientY-touchTarget.offsetTop;for(let e=0;e<kbState.length;++e)if(1==kbEnabled[e]&&c>keysRectScr[e].left&&c<keysRectScr[e].right&&n>keysRectScr[e].top&&n<keysRectScr[e].bottom){r[e]=!0,t=!0;break}if(0==t)for(let t=0;t<compRectScr.length;++t)if(c>compRectScr[t].left&&c<compRectScr[t].right&&n>compRectScr[t].top&&n<compRectScr[t].bottom){let e=compIndices[t][0];1==kbEnabled[e]&&(r[e]=!0),e=compIndices[t][1],1==kbEnabled[e]&&(r[e]=!0);break}for(let e=0;e<kbState.length;++e)1==kbEnabled[e]&&r[e]!=kbState[e]&&(1==kbState[e]?(kbState[e]=!1,kbTriggered[e]=!1,kbTriggerable[e]=!0):(kbState[e]=!0,1==kbTriggerable[e]&&(kbTriggered[e]=!0,kbTriggerable[e]=!1)));requestRender=!0},onTouchClear=function(e){0!=curTouches.length&&curTouches.slice(0,curTouches.length);for(let e=0;e<kbState.length;++e)kbState[e]=!1,kbTriggered[e]=!1,kbTriggerable[e]=!0;requestRender=!0,mouseDown=!1};