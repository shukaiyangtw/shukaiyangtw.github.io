var ballTex,desktopTex,arrowTex,bombTex,explodeTex,shotSfx=null,collideSfx=null,glassSfx=null,explodeSfx=null,succeedSfx=null,gameOverSfx=null,gameMusic=null,ballSounds=[],xt_music=!0,xt_audio=!0,dbg_span=null;function onPageResized(){canvasSize=autoCanvasSize(document.body),setElementSizeScr("startmenu",canvasSize),setElementSizeScr("arena",canvasSize),setElementSizeScr("buffer1",canvasSize),setElementSizeScr("buffer2",canvasSize),mapElementToCanvas("banner_img",0,50,600,200),mapElementToCanvas("intro_span",20,280,560,200,36),mapElementToCanvas("level_select_span",20,520,560,50,36),mapElementToCanvas("stage_select",20,580,560,50),mapElementToCanvas("howto_button",40,680,210,70,48),mapElementToCanvas("start_button",330,680,210,70,48),mapElementToCanvas("billboard_button",40,800,210,70,48),mapElementToCanvas("back_button",330,800,210,70,48),mapElementPosToCanvas("music_button",80,910),mapElementSizeToCanvas("music_icon",64,64),mapElementPosToCanvas("sound_button",270,910),mapElementSizeToCanvas("sound_icon",64,64),mapElementPosToCanvas("lang_button",450,910),mapElementSizeToCanvas("lang_icon",64,64),mapElementPosToCanvas("level_label",20,880,24),mapElementPosToCanvas("time_label",20,915,24),mapElementPosToCanvas("score_label",20,950,24),mapElementToCanvas("message_box",50,300,480,350,48);var e=Math.floor(48*densityX);let t=document.getElementById("msg_title");t.style.fontSize=e+"px";let n=document.getElementById("cont_button");n.style.fontSize=e+"px",e=Math.floor(36*densityX),t=document.getElementById("msg_bonus"),t.style.fontSize=e+"px",t=document.getElementById("msg_total"),t.style.fontSize=e+"px",requestRender=!0}function onPageLoaded(){frameBuffers.push(document.getElementById("buffer1")),frameBuffers.push(document.getElementById("buffer2")),null!=(dbg_span=document.getElementById("debug_msgs"))&&(showLocus=!0),setViewportSize(ARENA_WIDTH,ARENA_HEIGHT),onPageResized();let e=document.getElementById("stage_select");e.setAttribute("max",stage_arr.length);let t=localStorage.getItem("marbles_level");null!=t&&(curLevel=parseInt(t)),e.value=curLevel;let n=document.getElementById("level_select_span");if(n.innerHTML="LEVEL "+curLevel,t=localStorage.getItem("xt_music"),"false"==t){xt_music=!1;let e=document.getElementById("music_icon");e.src="../../images/music_off.png"}if(t=localStorage.getItem("xt_audio"),"false"==t){xt_audio=!1;let e=document.getElementById("sound_icon");e.src="../../images/sound_off.png"}ballTex=new TextureImage(3,7,"balls",null),desktopTex=new TextureImage(1,1,"desktop",null),arrowTex=new TextureImage(1,1,"arrow",null),bombTex=new TextureImage(1,1,"bomb",null),explodeTex=new TextureImage(1,1,"explode",null),touchTarget=document.getElementById("arena"),touchTarget.addEventListener("keydown",onKeyDown),touchTarget.addEventListener("keyup",onKeyUp),touchTarget.addEventListener("touchstart",onTouch),touchTarget.addEventListener("touchmove",onTouch),touchTarget.addEventListener("touchend",onTouch),touchTarget.addEventListener("touchcancel",onTouch),touchTarget.addEventListener("mousedown",onMouse),touchTarget.addEventListener("mousemove",onMouse),touchTarget.addEventListener("mouseup",onMouse)}function onMusicClicked(){if(1==xt_music){xt_music=!1;let e=document.getElementById("music_icon");e.src="../../images/music_off.png",localStorage.setItem("xt_music","false")}else{xt_music=!0;let e=document.getElementById("music_icon");e.src="../../images/music_on.png",localStorage.setItem("xt_music","true")}}function onSoundClicked(){if(1==xt_audio){xt_audio=!1;let e=document.getElementById("sound_icon");e.src="../../images/music_off.png",localStorage.setItem("xt_audio","false")}else{xt_audio=!0;let e=document.getElementById("sound_icon");e.src="../../images/music_on.png",localStorage.setItem("xt_audio","true")}}function onStageChange(e){var t=document.getElementById("stage_select");curLevel=t.value;let n=document.getElementById("level_select_span");n.innerHTML="LEVEL "+curLevel}function prepareCurStage(){let t=0,n=0,l=curLevel-1,e=document.getElementById("level_label");e.innerHTML="LEVEL "+curLevel,localStorage.setItem("marbles_level",curLevel.toString());for(let e=0;e<80;++e){var o=stage_arr[l][e];ballArr[t][n]=0==o?null:new Ball(t,n,o-1,BALL_REGULAR),++n,n==BALL_COLS&&(n=0,++t)}for(let t=8;t<BALL_ROWS;++t)for(let e=0;e<BALL_COLS;++e)ballArr[t][e]=null;curLevelMsecs=TIMER_INITIAL_MSECS,curBonus=0,shotBall=null,leftArrowIsDown=!1,rightArrowIsDown=!1,touchDownTime=0,mouseDown=!1;var a=getAvailableColors();l=Math.floor(Math.random()*a.length),curBall=new Ball(0,0,a[l],BALL_REGULAR),l=Math.floor(Math.random()*a.length),nextBall=new Ball(0,0,a[l],BALL_REGULAR),e=document.getElementById("msg_title"),e.innerHTML=STR_GET_READY,e=document.getElementById("msg_bonus"),e.innerHTML="",e=document.getElementById("msg_total"),e.innerHTML="LEVEL "+curLevel,lastTimerSecs=Math.ceil(TIMER_INITIAL_MSECS/1e3),e=document.getElementById("time_label"),e.innerHTML="TIME: "+lastTimerSecs;let s=document.getElementById("cont_button");s.style.display="none";let u=document.getElementById("message_box");u.style.display="block",gameState=PREPARING,preparingMsecs=INITIAL_PREPARE_MSECS}function onStartClicked(){if(prepareCurStage(),1==xt_audio){(shotSfx=document.getElementById("shot_sfx")).load(),(collideSfx=document.getElementById("collide_sfx")).load(),(glassSfx=document.getElementById("glass_sfx")).load(),(explodeSfx=document.getElementById("explode_sfx")).load(),(succeedSfx=document.getElementById("succeed_sfx")).load(),(gameOverSfx=document.getElementById("gameover_sfx")).load(),ballSounds.push(document.getElementById("hahaha_sfx")),ballSounds.push(document.getElementById("laugh2_sfx")),ballSounds.push(document.getElementById("yo_sfx")),ballSounds.push(document.getElementById("huh_sfx")),ballSounds.push(document.getElementById("laugh1_sfx")),ballSounds.push(document.getElementById("angry_sfx")),ballSounds.push(document.getElementById("hey_sfx"));for(let e=0;e<ballSounds.length;++e)ballSounds[e].load()}1==xt_music&&((gameMusic=new Audio("bicycle.mp3")).loop=!0,gameMusic.onloadeddata=function(){gameMusic.play()},gameMusic.load());let e=document.getElementById("startmenu");e.style.display="none";let t=document.getElementById("arena");t.style.display="block",t.focus(),curDate=Date.now(),gameTimerID=setInterval(onUpdate,msecsPerFrame)}