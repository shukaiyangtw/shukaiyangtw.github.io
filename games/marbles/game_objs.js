const BALL_WIDTH=57,BALL_HEIGHT=57,BALL_HALF_WIDTH=28.5,BALL_HALF_HEIGHT=28.5,BALL_COLS=10,BALL_ROWS=14,LAST_COL_INDEX=9,LAST_ROW_INDEX=13,ARENA_WIDTH=600,ARENA_HEIGHT=1e3;var canvasSize=new ivec2(ARENA_WIDTH,ARENA_HEIGHT);const BALL_REGULAR=0,BALL_PLUS5=1,BALL_BOMB=2;function Ball(l,n,u,r){this.row=l,this.col=n,this.colorIndex=u,this.ballType=r,this.x=n*BALL_WIDTH+BALL_HALF_WIDTH,l%2==1&&(this.x+=BALL_HALF_WIDTH),this.y=l*BALL_HEIGHT+BALL_HALF_HEIGHT,this.velocity=new ivec2(0,0),this.fallingVelocity=BALL_FALLING_PER_MSEC,this.fallingMsecs=0}Ball.prototype.getXYByRowCol=function(){this.x=this.col*BALL_WIDTH+BALL_HALF_WIDTH,this.row%2==1&&(this.x+=BALL_HALF_WIDTH),this.y=this.row*BALL_HEIGHT+BALL_HALF_HEIGHT};var ballArr=[[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null]],clusteredArr=[[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1]];function getAvailableColors(){let u=[!1,!1,!1,!1,!1,!1,!1];for(let n=0;n<BALL_ROWS;++n)for(let l=0;l<BALL_COLS;++l)null!=ballArr[n][l]&&(u[ballArr[n][l].colorIndex]=!0);let n=[];for(let l=0;l<7;++l)1==u[l]&&n.push(l);return n}function getNeighbors(l,n){let u=[];var r,e,L,A;return 0<n&&(r=n-1,null!=ballArr[l][r]&&u.push(ballArr[l][r])),n<LAST_COL_INDEX&&(e=n+1,null!=ballArr[l][e]&&u.push(ballArr[l][e])),l%2==1?(0<l&&(null!=ballArr[r=l-1][n]&&u.push(ballArr[r][n]),n<LAST_COL_INDEX&&(e=n+1,null!=ballArr[r][e]&&u.push(ballArr[r][e]))),l<LAST_ROW_INDEX&&(null!=ballArr[L=l+1][n]&&u.push(ballArr[L][n]),n<LAST_COL_INDEX&&(A=n+1,null!=ballArr[L][A]&&u.push(ballArr[L][A])))):(0<l&&(null!=ballArr[L=l-1][n]&&u.push(ballArr[L][n]),0<n&&(A=n-1,null!=ballArr[L][A]&&u.push(ballArr[L][A]))),l<LAST_ROW_INDEX&&(null!=ballArr[l=l+1][n]&&u.push(ballArr[l][n]),0<n&&(n=n-1,null!=ballArr[l][n]&&u.push(ballArr[l][n])))),u}function findCluster(n){for(let n=0;n<BALL_ROWS;++n)for(let l=0;l<BALL_COLS;++l)clusteredArr[n][l]=!1;let u=[n],r=[n];for(clusteredArr[n.row][n.col]=!0;0!=r.length;){var l=r.shift(),e=getNeighbors(l.row,l.col);for(let l=0;l<e.length;++l){var L=e[l];0==clusteredArr[L.row][L.col]&&L.colorIndex==n.colorIndex&&(clusteredArr[L.row][L.col]=!0,u.push(L),r.push(L))}}return u}function markRootClusters(){for(let n=0;n<BALL_ROWS;++n)for(let l=0;l<BALL_COLS;++l)clusteredArr[n][l]=!1;for(let l=0;l<BALL_COLS;++l)if(null!=ballArr[0][l]&&0==clusteredArr[0][l]){clusteredArr[0][l]=!0;let n=[ballArr[0][l]];for(;0!=n.length;){var u=n.shift(),r=getNeighbors(u.row,u.col);for(let l=0;l<r.length;++l){var e=r[l];0==clusteredArr[e.row][e.col]&&(clusteredArr[e.row][e.col]=!0,n.push(e))}}}}function deleteBallCluster(u,r){for(let n=0;n<u.length;++n){let l=u[n];l.ballType==BALL_PLUS5&&(curLevelMsecs+=5e3),ballArr[l.row][l.col]=null,1==r&&(l.fallingVelocity=BALL_FALLING_PER_MSEC+.1*Math.random(),l.fallingMsecs=BALL_FALLING_MSECS,fallingBalls.push(l))}lastTimerSecs=Math.ceil(curLevelMsecs/1e3);let l=document.getElementById("time_label");l.innerHTML="TIME: "+lastTimerSecs}